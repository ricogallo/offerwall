!function(){"use strict";var e="http://www.360dialog.com/fe-challenge/offers.json",n=document.querySelector(".offers"),t=document.querySelector(".status"),a=function(e){return JSON.parse(localStorage.getItem(e)||"{}")},r=function(e,n){localStorage.setItem(e,JSON.stringify(n))},s=function(){return new Promise(function(n,t){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(){if(this.status>=200&&this.status<300){var e=JSON.parse(this.response).offers;n(e)}else t("There is an error from server! %s",this.status)},a.send()})},o=function(e){return new Promise(function(n,t){n(e)})},c=function(e){var n="img"===e.name?new Image:document.createElement(e.name);return e.className&&(n.className=e.className),e.src&&(n.src=e.src),e.text&&(n.innerText=e.text),e.parent&&e.parent.appendChild(n),n},i=function(e,n){return Array.prototype.indexOf.call(e,n)},f=function(e){var n=c({name:"li",className:"offers__item"}),t=(c({name:"img",className:"offers__banner",src:e.bannerUrl,parent:n}),c({name:"div",className:"offers__body",parent:n})),a=(c({name:"span",className:"offers__title",text:e.content_parameters.title,parent:t}),c({name:"ul",className:"offers__taglist",parent:t}));e.content_parameters.tags.forEach(function(e){c({name:"li",className:"offers__tag",text:e,parent:a})});var r=c({name:"div",className:"offers__credits-container",parent:n});c({name:"span",className:"offers__credits-counter",text:e.credits,parent:r}),c({name:"span",className:"offers__hint",text:e.content_parameters.hint,parent:r});return n},u=function(e){var n=a("offers");n[e.campaign]=n[e.campaign]?+n[e.campaign]+1:1,r("offers",n);var t=a("tags");e.content_parameters.tags.forEach(function(e){t[e]=t[e]?+t[e]+1:1}),r("tags",t)},m=function(e){var n=a("offers"),t=n[e.campaign]?n[e.campaign]:0;return t>=3},l=function(e){var n=a("tags");return+n[e]||0},p=function(e){return e.content_parameters.tags.reduce(function(e,n){return l(e)+l(n)},0)},d=function(e,t){t.addEventListener("click",function(){u(e),m(e)&&n.removeChild(t),o({offer:{campaign:e.campaign,position:i(n.childNodes,t)}}).then(function(n){console.log(n),window.location=e.clickUrl})},!1)},g=function(e){n.appendChild(e)};s().then(function(e){document.body.removeChild(t);var n=o({offers:e.map(function(e){return e.campaign})});return e.sort(function(e,n){return p(e)>p(n)?-1:p(e)<p(n)?1:0}),e.forEach(function(e){if(e.isIncentive&&!e.isFallback&&!m(e)){var n=f(e);d(e,n),g(n)}}),n}).then(function(e){console.log(e)})["catch"](function(e){t.innerText=e})}();
//# sourceMappingURL=script.min.js.map
